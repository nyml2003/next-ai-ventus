# 产品功能规划

## 产品定位

**面向开发者的轻量级博客系统**

- **核心价值**：用管理代码的方式管理内容
- **目标用户**：技术博主、独立开发者、追求内容掌控权的内容创作者
- **关键差异**：文件存储 + Git 管理 + 简单部署

---

## 用户角色

### 读者（Visitor）

- 浏览文章、搜索内容
- 无需登录，完全开放访问

### 作者（Author）

- 创作、编辑、发布文章
- 管理标签、上传图片
- 查看文章数据（阅读量等）

### 管理员（Admin）

- 管理所有文章
- 系统配置（预留）
- 用户管理（预留）

> v0.1 阶段合并 Author 和 Admin 角色，单用户模式。

---

## 功能矩阵

### 内容消费（C 端）

| 用户场景 | 功能 | 架构支撑 |
|---------|------|---------|
| 进入首页，想看到最新文章 | 文章列表（按时间倒序） | BFF `postList` 模块，内存索引排序 |
| 对某技术领域感兴趣，想筛选文章 | 标签筛选 | URL query 参数 + 内存 TagMap 索引 |
| 找到感兴趣的文章，点击进入阅读 | 文章详情页 | BFF `article` + `toc` 模块，后端拼链跳转 |
| 文章太长，想快速定位章节 | 目录导航（TOC） | BFF `toc` 模块，Markdown 解析生成 |
| 读完文章，想看相关推荐 | 相关文章 | BFF `related` 模块，基于标签匹配 |
| 想找特定内容 | 全文搜索 | 内存倒排索引（预留接入 Meilisearch） |
| 阅读代码片段 | 代码高亮 | Markdown 渲染器集成 highlight.js |
| 夜间阅读 | 深色模式 | 主题系统 CSS 变量 |

### 内容生产（B 端）

| 用户场景 | 功能 | 架构支撑 |
|---------|------|---------|
| 新建文章 | 编辑器（Markdown） | BFF `editor` 模块，实时预览 |
| 写作时插入图片 | 图片上传 | 独立接口 `POST /api/admin/upload` |
| 暂时不想发布，保存草稿 | 草稿状态 | meta.json `status` 字段控制 |
| 发布后修改文章 | 文章编辑 | 乐观锁 version 字段防并发覆盖 |
| 管理所有文章 | 文章列表（管理视图） | BFF `adminPostList` 模块 |
| 查看文章数据 | 阅读量统计 | `POST /api/posts/:id/view` 埋点 |

### 系统功能

| 用户场景 | 功能 | 架构支撑 |
|---------|------|---------|
| 访问管理后台 | JWT 登录鉴权 | 独立登录页，Cookie 存储 token |
| 数据备份 | Git 提交 | content/ 目录版本控制 |
| 服务器迁移 | 数据导出 | 文件打包，无数据库迁移 |
| 性能优化 | CDN 加速 | Nginx 静态资源配置长期缓存 |

---

## 功能优先级

### P0 - MVP 必需

**内容消费**
- [x] 首页文章列表
- [x] 文章详情页
- [x] 标签筛选
- [x] 代码高亮

**内容生产**
- [x] Markdown 编辑器
- [x] 文章 CRUD
- [x] 图片上传
- [x] JWT 登录

**系统**
- [x] 文件存储
- [x] 内存索引
- [x] BFF 框架

### P1 - 体验优化

**内容消费**
- [ ] 全文搜索
- [ ] 相关文章推荐
- [x] 文章目录（TOC）
- [ ] SEO 优化（Sitemap、Open Graph）

**内容生产**
- [ ] 编辑器自动保存
- [ ] 草稿预览
- [ ] 批量操作

### P2 - 进阶功能

- [ ] 深色模式（多主题支持）
- [ ] 评论系统（Giscus）
- [ ] 文章导入导出
- [ ] 多用户支持
- [ ] 统计分析
- [ ] 移动端适配

### P3 - 生态建设

- [ ] 插件系统
- [ ] 主题市场
- [ ] CLI 工具
- [ ] 一键部署脚本

---

## 架构与功能的映射

### 为什么选择「文件存储」？

**产品需求**：用户希望内容完全可控，易于备份和迁移

**技术实现**：
- content/ 目录存储 meta.json + content.md
- Git 天然支持版本控制
- 备份只需 `tar czvf` 或直接 `git push`

### 为什么选择「BFF 架构」？

**产品需求**：
- 页面加载快（用户体验）
- 前后端解耦（开发效率）
- 灵活组装数据（支持不同页面配置）

**技术实现**：
- 统一 `POST /api/page` 接口
- 模块化设计，并行执行
- 前端声明所需模块，后端按需组装

### 为什么选择「MPA + 共享 Chunk」？

**产品需求**：
- 首屏加载快（SEO + 用户体验）
- 各页面独立（一个页面出错不影响其他）
- 代码复用（减少重复加载）

**技术实现**：
- Vite 多入口构建
- Rollup manualChunks 自动提取共享代码
- 独立 HTML 入口，Nginx 直接 serve

### 为什么「无数据库」？

**产品需求**：部署简单，运维成本低

**技术实现**：
- 内存索引（文章数 < 1000 时性能足够）
- 文件系统存储
- 单二进制文件部署

**权衡**：文章数 > 10,000 时需引入数据库（预留扩展点）

---

## 非功能需求

### 性能目标

| 指标 | 目标 | 当前状态 |
|------|------|---------|
| 首屏加载时间 | < 1s（国内） | 待测试 |
| API 响应时间 | P99 < 100ms | 内存查询，微秒级 |
| 服务器内存 | < 50MB | 约 20MB |
| 并发支持 | 100 QPS | 静态资源走 Nginx，无压力 |

### 图片访问策略

- **公开访问**：文章列表、文章详情等 C 端页面展示的图片需要公开访问（无需鉴权）
- **管理访问**：图片管理、上传等 B 端接口需要 JWT 鉴权
- **防盗链**：通过 Referer 校验或 Nginx 配置限制图片被外部网站直接引用

### 安全要求

- 文件路径校验（防目录遍历）
- JWT 鉴权（管理后台）
- XSS 防护（Markdown 渲染 sanitize）

### 兼容性

- PC Chrome 最新版
- 不支持移动端
- 暂不支持 IE/Edge Legacy

---

## 页面清单

### C 端页面（读者）

| 页面 | URL | 核心功能 | 优先级 |
|------|-----|---------|--------|
| **首页** | `/` | 展示文章列表、站点信息、标签云 | P0 |
| **文章详情** | `/post/:slug` | 展示文章内容、目录、相关推荐 | P0 |
| **标签筛选** | `/?tag=xxx` | 按标签筛选文章列表 | P0 |
| **搜索结果** | `/search?q=xxx` | 展示搜索结果 | P1 |
| **关于页面** | `/about` | 个人介绍、联系方式 | P1 |
| **归档页面** | `/archive` | 按时间线展示所有文章 | P1 |

### B 端页面（作者/管理员）

| 页面 | URL | 核心功能 | 优先级 |
|------|-----|---------|--------|
| **登录页** | `/login` | JWT 登录 | P0 |
| **管理首页** | `/admin` | 仪表盘（文章统计、快捷入口） | P0 |
| **文章管理** | `/admin/posts` | 文章列表（增删改查、状态筛选） | P0 |
| **文章编辑** | `/admin/editor?id=xxx` | Markdown 编辑器、预览、保存 | P0 |
| **图片管理** | `/admin/images` | 已上传图片列表、删除 | P1 |
| **系统设置** | `/admin/settings` | 站点配置、主题切换 | P2 |

> **为什么 `/admin` 和 `/admin/posts` 是独立页面而非 Tab 切换？**
> 
> 1. **独立 URL 便于直接访问** - 用户可以通过 `/admin/posts` 直接定位到文章管理，无需先进入仪表盘再切换 Tab
> 2. **状态隔离更清晰** - 文章管理页的筛选状态不会与仪表盘冲突，刷新页面后状态保持
> 3. **代码组织更简单** - 独立页面对应独立代码入口，避免单页面内复杂的条件渲染逻辑
> 4. **符合用户心智模型** - 仪表盘是「概览」，文章管理是「列表操作」，两者功能定位不同，独立页面更清晰

### 独立页面

| 页面 | URL | 用途 | 优先级 |
|------|-----|------|--------|
| **404** | `/404` | 页面未找到 | P0 |
| **500** | `/500` | 服务器错误 | P0 |

---

## 页面结构说明

### C 端首页 (`/`)

**模块组成：**
- Header - 站点 Logo、导航、主题切换
- Hero - 站点标题、简介（可选）
- PostList - 文章卡片列表（分页/加载更多）
- Sidebar - 标签云、热门文章（可选）
- Footer - 版权信息、备案号

**用户行为：**
- 滚动浏览文章列表
- 点击文章卡片进入详情
- 点击标签筛选文章
- 翻页/加载更多

### 文章详情页 (`/post/:slug`)

**模块组成：**
- Header - 返回按钮、站点导航
- Article - 文章标题、元信息、正文内容
- TOC - 目录导航（右侧悬浮或左侧固定）
- Related - 相关文章推荐
- Footer - 上一篇/下一篇导航

**用户行为：**
- 阅读文章
- 点击目录跳转到章节
- 点击相关文章继续阅读
- 点击返回回到列表

### 管理后台 (`/admin/*`)

**整体布局：**
- Sidebar - 菜单导航（文章管理、图片管理、设置）
- Main Content - 各页面内容区域

**文章管理页：**
- 表格展示文章列表（标题、状态、时间、操作）
- 搜索/筛选（按状态、按标签）
- 批量操作（删除、发布）
- 新建/编辑入口

**文章编辑页：**
- 分栏布局：左侧编辑器、右侧预览
- 顶部工具栏：保存、发布、返回
- 侧边设置：标题、标签、状态、封面图

---

## 用户旅程

### 首次使用

```
1. 开发者看到项目 → GitHub README
2. 感兴趣 → 按照 Quick Start 本地启动
3. 访问 localhost:3000 → 看到首页
4. 访问 localhost:3000/admin → 进入管理后台
5. 创建第一篇文章 → 在首页看到效果
6. 决定使用 → 部署到服务器
```

### 读者访问旅程

```
1. 通过搜索引擎/社交媒体进入首页 `/`
2. 浏览文章列表，点击感兴趣的文章 → `/post/:slug`
3. 阅读文章内容，查看代码高亮
4. 点击标签查看更多相关文章 → `/?tag=xxx`
5. 点击文章继续阅读 → `/post/:another-slug`
```

### 作者写作旅程

```
方式一：本地编辑（推荐）
1. 打开本地编辑器
2. 在 content/posts/ 下新建 Markdown 文件
3. git add / commit / push
4. 服务器自动更新

方式二：Web 编辑器
1. 访问 `/admin` 进入管理后台
2. 点击新建 → 进入 `/admin/editor`
3. 编辑标题、内容、标签
4. 点击发布
5. 返回 `/admin/posts` 查看文章列表
```

### 管理员操作旅程

```
1. 访问 `/login` 登录
2. 进入 `/admin` 仪表盘
3. 管理文章 `/admin/posts`
   - 编辑、删除、修改状态
4. 管理图片 `/admin/images`
   - 查看、删除已上传图片
5. 系统设置 `/admin/settings`
   - 修改站点信息（P2）
```
